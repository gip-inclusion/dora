sources:
  - name: dora
    schema: public
    description:
    Schéma contenant les tables sources issues de la prod de DORA, ainsi que les tables contenant les structures et services data inclusion (di_services et di_structures).
    Seules les champs ambigus ou pertinents pour les transformations sont documentés ci-dessous.
    tables:
      - name: orientations_orientation
        description:
        Liste des orientations.
        Une orientation (id) correspond à l'envoi d'un formulaire de la part d'un precripteur (prescriber_id).
        Un formulaire étant la recommandation d'un service (service_id) à un tiers (beneficiary).
        columns:
        - name: prescriber_id
          description:
          Identifiant du prescripteur de cette orientation, correspondant à la clé primaire de la table user.
        - name: prescriber_structure_id
          description:
          Identifiant de la structure du prescripteur, correspondant à la clé primaire de la table structure.
        - name: service_id
          description:
          Identifiant du service orienté au bénéficiaire, correspondant à la clé primaire de la table service.
        - name: creation_date
          description:
          Date d'envoi de l'orientation.
        - name: processing_date
          description:
          Date de prise en compte de l'orientation.
          Vide lorsque l'orientation est encore ouverte ou que la modération a été rejetée (sauf quelques cas particuliers à la marge).
        - name: status
          description:
          État de l'orientation (modération_en_cours, modération_rejetée, ouverte, refusée, validée).

      - name: orientations_rejectionreason
        description:
        Table de correspondance id-label des motifs de refus des orientations refusées.
        columns:
        - name: id
          description:
          Identifiant motif de refus. Correspondant à rejectionreason_id dans la table orientations_orientation_rejection_reasons.
        - name: label
          description:
          Description textuelle du motif de refus.
        - name: value
          description:
          Label textuel du motif de refus.

      - name: orientations_orientation_rejection_reasons
        description:
        Motifs de refus des orientations refusées.
        columns:
        - name: id
          description:
          Identifiant de la paire orientation refusée / motif de refus
        - name: orientation_id
          description:
          Identifiant de l'orientation refusée.
        - name: value
          description:
          Identifiant du motif de refus.

      - name: services_fundinglabel
        description:
        Table de correspondance id-fundinglabel des labels de financement.

      - name: services_locationkind
        description:
        Table de correspondance id-locationkind des services.
        Attention toutes les aides financières sont de type `à distance`.

      - name: services_savedsearch
        ToDo: à clarifier avec métier

      - name: services_service
        description:
        Liste des services.
        Un service est rattaché à une structure (structure_id).
        Ne contient pas les services data inclusion qui sont eux récupérés via `fetch_and_export_di_data` dans les tables `di_structures` et `di_services`.
        Attention, les services data inclusion affichés sur DORA ne sont qu'un sous ensemble des services contenus dans la table di_services, car filtrés selon des règles de localisation ou de score de qualité.
        columns:
        - name: id
          description:
          Identifiant du service.
        - name: creator_id
          description:
          Identifiant de l'utilisateur ayant créé le service.
        - name: structure_id
          description:
          Identifiant de la structure à laquelle le service est rattaché.
        - name: model_id
          description:
          Identifiant du service modèle utilisé comme base pour le service (champs vide si aucun modèle utilisé).
        - name: is_model
          description:
          Booleen à oui true si le service est un modèle. False sinon.

      - name: services_service_categories
        description:
        Catégorie à laquelle un service est rattaché (mobilité, emploi, santé..).

      - name: services_servicecategory
        description:
        Table de correspondance id-servicecategory.

      - name: services_service_coach_orientation_modes
        ToDo: à documenter avec le métier

      - name: services_coachorientationmodes
        ToDo: à documenter avec le métier

      - name: services_service_funding_labels
        description:
        Labels de financement des services financés.

      - name: services_service_location_kinds
        description:
        Type de mise à disposition des services (à distance ou en présentiel).

      - name: stats_deploymentstate
        description:
        Etat de déploiement pour chaque département.
        Donnée complétée à la main sur l'admin par les bizdev en fonction du stade de maturité.
        Doc maturité : https://www.notion.so/gip-inclusion/Calcul-de-la-maturit-1995f321b6048092b876f7b08a87fa11

      - name: stats_dimobilisationevent
        description:
        Événements de mobilisation (visualisation de fiche service ou d'informations de contact) sur les services data inclusion.

      - name: stats_dimobilisationevent_categories
        description:
        Catégorie des services concernés par les événements de mobilisation.

      - name: stats_diserviceview
        description:
        Événements de visualisation de services data inclusion.

      - name: stats_mobilisationevent
        description:
        Événements de mobilisation des services dora.
        columns:
        - name: id
          description:
          Identifiant de l'événement de mobilisation.
        - name: path
          description:
          Slug de la page concernée.
        - name: date
          description:
          Date de l'événement.
        - name: service_id
          description:
          Identifiant du service concerné, clé primaire de la table service.
        - name: structure_id
          description:
          Identifiant de la structure concernée, clé primaire de la table structure.
        - name: user_id
          description:
          Si non vide, id de l'utilisateur connecté ayant réalisé la mobilisation.

      - name: stats_mobilisationevent_categories
        description:
        Catégorie des services concernés par les événements de mobilisation.

      - name: stats_pageview
        description:
        Événements de visualisation d'une page sur dora (structure, service, page de connexion..).
        description:
        Événements de mobilisation des services dora.
        columns:
        - name: id
          description:
          Identifiant de l'événement de visualisation d'une page.
        - name: path
          description:
          Slug de la page concernée.
        - name: date
          description:
          Date de la visualisation.
        - name: user_id
          description:
          Si non vide, id de l'utilisateur connecté ayant réalisé la visualisation.

      - name: stats_searchview
        description:
        Événements de recherche d'un service ou d'une structure.
        Attention, ici ne sont pas enregistrées les recherches réalisées avec la barre de recherche (nouvelle feature 2025).

      - name: stats_searchview_categories
        description:
        Catégorie des services concernés par les événements de recherche.

      - name: stats_serviceview
        description:
        Événements de visualisation d'une page service.

      - name: stats_structureinfosview
        description:
        Événements de visualisation des informations d'une structure.

      - name: stats_structureview
        description:
        Événements de visualisation d'une page structure.

      - name: structures_structure
        description:
        Liste des structures.
        columns:
        - name: id
          description:
          Identifiant de la structure.
        - name: creator_id
          description:
          Identifiant de l'utilisateur ayant créé la structure.
        - name: typology
          description:
          Typologie de la structure. Fiable pour CAP_EMPLOI, FT et ML.

      - name: structures_structuremember
        description:
        Table de correspondance entre les utilisateurs et leur structures de rattachement pour les utilisateurs rattachés.

      - name: structures_structurenationallabel
        description:
        Table de correspondance id-nationallabel.

      - name: structures_structure_national_labels
        description:
        Labels nationaux des structures.

      - name: structures_structureputativemember
        description:
        Table de correspondance entre les utilisateurs et leur structure potentielle, pour lesquels le rattachement n'est pas finalisé (invitation en attente ou demande de rattachement en attente)

      - name: structures_structuretypology
        description:
        Typologie des structures (donnée déclarative, fiable pour FT, ML et les CD).

      - name: users_user
        description:
        Liste des utilisateurs.
        columns:
        - name: id
          description:
          Identifiant de l'utilisateur.
        - name: password
          description:
          Attention. Un mot de passe est automatiquement généré par le modèle django depuis 2025. Donc tous les utilisateurs, y compris ceux n'ayant pas encore réellement créé un compte, en ont un.
        - name: last_login
          description:
          Date de dernière connexion. Lorsqu'elle est vide, l'utilisateur a été créé suite à un envoi d'invitation par une structure, mais n'a pas encore été activer son compte.
        - name: is_staff
          description:
          Membres de l'équipe DORA.
        - name: is_active
          description:
          Par défaut, tous les utilisateurs sont actifs. Peuvent devenir inactif après demande de modération.
        - name: date_joined
          description:
          Date de création du compte, que ce soit pas l'utilisateur lui même, ou par envoi d'une invitation.
        - name: is_valid
          description:
          L'adresse email a été vérifiée (vérification avec pro connect).
        - name: is_manager
          description:
          Utilisateurs gestionnaires.
        - name: main_activity
          description:
          Distinction plus très utile aujourd'hui, et pas forcément fiable, car un accompagnateur peut être offreur.
          À valider avec métier mais sauf erreur, cette catégorie est choisie par l'utilisateur à la création du compte.
        - name: sub_pc
          description:
          Identifiant pro connect.

  - name: matomo
    schema: public
    tables:
      - name: mtm_share_service_tracking


