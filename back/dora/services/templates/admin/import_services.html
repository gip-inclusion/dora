{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block breadcrumbs %}
  <div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='services' %}">Administration de services</a>
    &rsaquo; <a href="{% url 'admin:services_service_changelist' %}">Services</a>
    &rsaquo; Importer Services
  </div>
{% endblock %}

{% block content %}
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <fieldset class="module aligned">
      <div class="form-row">
        <div>
          <label for="csv_file">Fichier d'import</label>
          <div class="help">Format attendu : ficher.csv </div>
          <input type="file" name="csv_file" accept=".csv" required>
        </div>
        <div>
          <label for="source_label">Nom de la source :</label>
          <div class="help" style="margin-bottom: 8px">Nom de la structure, du producteur de données, laisser vide si c'est nous (DORA) </div>
          <input
            type="text"
            name="source_label"
            id="source_label"
            placeholder="Label de source"
          >
        </div>
        <div>
          <label for="test_run">Test Run?</label>
          <input
            type="checkbox"
            name="test_run"
            id="test_run"
            checked
          />
          <div class="help">Cochez pour vérifier la conformité de votre fichier avant l'import définitif</div>
        </div>
      </div>
    </fieldset>

    <div class="submit-row">
      <input type="submit" value="Import" class="default" />
      <a href="{% url 'admin:services_service_changelist' %}" class="button cancel-link">Cancel</a>
    </div>
  </form>

  <div class="help">
    <p>Upload a CSV file with the following columns:</p>
    <ul>
      {% for header in csv_headers %}
        <li>{{ header }}</li>
      {% empty %}
        <li>Aucun en-tête disponible</li>
      {% endfor %}
    </ul>
  </div>


  <script>
    document.getElementById('csv-file-input').addEventListener('change', function(e) {
      const fileStatus = document.getElementById('file-status');
      if (e.target.files.length > 0) {
        const fileName = e.target.files[0].name;
        fileStatus.textContent = `✅ Fichier sélectionné: ${fileName}`;
        fileStatus.className = 'file-status selected';
      } else {
        fileStatus.textContent = 'Aucun fichier sélectionné';
        fileStatus.className = 'file-status';
      }
    });
  </script>
{% endblock %}